import requests; import time; import statistics; import json; import sys; def benchmark_latency(url, num_requests=100): latencies = []; errors = 0; print(f"Testing {num_requests} requests to {url}"); [latencies.append((lambda: (time.perf_counter(), requests.get(url, timeout=30), time.perf_counter()))() and (lambda start, resp, end: latencies.append((end-start)*1000) if resp.status_code < 400 else errors.__iadd__(1))(*_) for _ in range(num_requests) if not (_ % 10 and print(f"Progress: {_+1}/{num_requests}"))]; results = {"avg_ms": statistics.mean(latencies), "median_ms": statistics.median(latencies), "p95_ms": sorted(latencies)[int(0.95*len(latencies))], "errors": errors} if latencies else None; print(results); return results; benchmark_latency(sys.argv[1], int(sys.argv[2]) if len(sys.argv) > 2 else 100) if len(sys.argv) > 1 else print("Usage: python latency_test.py <url> [requests]")
